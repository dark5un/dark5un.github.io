---
layout: post
title:  "Challenge 1 - Java Web API"
date:   2017-02-09 01:31:00 +0000
categories: java web api
comments: true
---
Challenge? Well yes why not?

So lets start creating a Java API using the [1337](https://en.wikipedia.org/wiki/Leet)est of the [1337](https://en.wikipedia.org/wiki/Leet)est and as hardcore as possible! Always in a main stream fashion. (Don't ask me how I want to achieve this. I have no clue so far)

Tools for the thing? Hmmm lets start with [Gradle](https://gradle.org/)! Who cares about [Ant](http://ant.apache.org/) anymore and lately [Maven](https://maven.apache.org/) seems so 2k (put troll emoticon here).

Ok Mr Gradle I would like a nice clean project for my app to run:

```bash
$ gradle init --type java-application --test-framework spock
``` 

this will output:
```groovy
/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/3.3/userguide/tutorial_java_projects.html
 */

// Apply the java plugin to add support for Java
apply plugin: 'java'

// Apply the application plugin to add support for building an application
apply plugin: 'application'

// Apply the groovy plugin to also add support for Groovy (needed for Spock)
apply plugin: 'groovy'

// In this section you declare where to find the dependencies of your project
repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

dependencies {
    // The production code uses Guava
    compile 'com.google.guava:guava:20.0'

    // Use the latest Groovy version for Spock testing
    testCompile 'org.codehaus.groovy:groovy-all:2.4.7'

    // Use the awesome Spock testing and specification framework even with Java
    testCompile 'org.spockframework:spock-core:1.0-groovy-2.4'
    testCompile 'junit:junit:4.12'
}

// Define the main class for the application
mainClassName = 'App'
```

Why [Spock](http://spockframework.org) instead of [TestNG](http://testng.org) (and why not [JUnit](http://junit.org))?

Because Spock had enough love in its site and because it is a cool name. Ok [Groovy](http://www.groovy-lang.org) is stupid easy to play with, that is why. And testing in Java sucks. (Yes I am doing group therapy for what I just said)

Gradle init has finished and there is a basic folder structure. Look ma no hands! How 2017 this feels! But the Gradle people made it even better! They created a basic java app structure. And added [Google Guava](https://github.com/google/guava) as a dependency!

Why java-application type you said? Well I was thinking about [Spring Boot](https://projects.spring.io/spring-boot) and felt so good to just start my app from command line. I can do it with [Node.js and Express](http://expressjs.com) I can certainly do it with [Rails](http://rubyonrails.org) so there you go. Java saw the light finally!

So now we have almost what we need. Spring libraries are not here yet. Lets just use the web starter of spring boot.

So build.gradle should look like this:

```groovy
buildscript {
	ext {
		springBootVersion = '1.5.1.RELEASE'
	}
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
	}
}

// Apply the java plugin to add support for Java
apply plugin: 'java'

// Apply the application plugin to add support for building an application
apply plugin: 'application'

// Apply the groovy plugin to also add support for Groovy (needed for Spock)
apply plugin: 'groovy'

// Apply the spring boot plugin
apply plugin: 'org.springframework.boot'

jar {
	baseName = 'demo'
	version = '0.0.1-SNAPSHOT'
}

sourceCompatibility = 1.8

repositories {
	mavenCentral()
}


dependencies {
  // The production code uses Guava
	compile 'com.google.guava:guava:20.0'
	compile 'org.springframework.boot:spring-boot-starter-web'
  // Use the latest Groovy version for Spock testing
    testCompile 'org.codehaus.groovy:groovy-all:2.4.7'

  // Use the awesome Spock testing and specification framework even with Java
	testCompile('org.springframework.boot:spring-boot-starter-test')
    testCompile 'org.spockframework:spock-core:1.0-groovy-2.4'
    testCompile 'junit:junit:4.12'
}

// Define the main class for the application
mainClassName = 'App'
```

Now lets change src/main/java/App.java to:

```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/*
 * This Java source file was generated by the Gradle 'init' task.
 */
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

and run it by issuing:

```bash
./gradlew bootRun
```

and we get a nice failure because:

```
** WARNING ** : Your ApplicationContext is unlikely to start due to a @ComponentScan of the default package.
```

Lets try and set a proper classpath. So move the App.java in a directory under src/main/java/org/example/apps. 
Don't forget to add this:
```java
package org.example.apps;

```
on top of the App.java.

Run it again and now:
```
Execution failed for task ':bootRun'.
```
Yes! We need to update build.gradle to 
```groovy
mainClassName = 'org.example.apps.App'
```

Finally start it and ... voila!! 
```
2017-02-13 22:38:51.568  INFO 48462 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2017-02-13 22:38:51.658  INFO 48462 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
2017-02-13 22:38:51.664  INFO 48462 --- [           main] org.example.apps.App                     : Started App in 3.595 seconds (JVM running for 3.942)
```

Instead of the bootRun gradle task you can also use: 
```bash
./gradlew run
```
thanks to application plugin. More information about gradle plugins and where to go from here because our app does not do much now, in the next adventure. Stay tuned! 